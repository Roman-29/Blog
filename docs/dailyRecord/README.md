# 2019

## åä¸€æœˆ

### ä»€ä¹ˆæ˜¯å‰ç«¯è·¨åŸŸä»¥åŠä½œç”¨

#### æµè§ˆå™¨çš„åŒæºç­–ç•¥

åŒæºç­–ç•¥é™åˆ¶äº†ä»åŒä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚

#### åŒæºçš„å®šä¹‰

å¦‚æœä¸¤ä¸ªé¡µé¢çš„åè®®ï¼Œç«¯å£ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰å’Œä¸»æœºéƒ½ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„æºã€‚
ä¸‹è¡¨ç»™å‡ºäº†ç›¸å¯¹http://store.company.com/dir/page.htmlåŒæºæ£€æµ‹çš„ç¤ºä¾‹:

URL|ç»“æœ|åŸå› 
-|-|-
http://store.company.com/dir2/other.html|æˆåŠŸ|åªæœ‰è·¯å¾„ä¸åŒ
http://store.company.com/dir/inner/another.html|æˆåŠŸ|åªæœ‰è·¯å¾„ä¸åŒ
https://store.company.com/secure.html|å¤±è´¥|ä¸åŒåè®® ( httpså’Œhttp )
http://store.company.com:81/dir/etc.html|å¤±è´¥|ä¸åŒç«¯å£ ( http:// 80æ˜¯é»˜è®¤çš„)
http://news.company.com/dir/other.html|å¤±è´¥|ä¸åŒåŸŸå ( newså’Œstore )

#### æ²¡æœ‰åŒæºç­–ç•¥é™åˆ¶çš„ä¸¤å¤§å±é™©åœºæ™¯

**æ²¡æœ‰åŒæºç­–ç•¥é™åˆ¶çš„æ¥å£è¯·æ±‚**

æœ‰ä¸€ä¸ªå°å°çš„ä¸œè¥¿å«cookieå¤§å®¶åº”è¯¥çŸ¥é“ï¼Œä¸€èˆ¬ç”¨æ¥å¤„ç†ç™»å½•ç­‰åœºæ™¯ï¼Œç›®çš„æ˜¯è®©æœåŠ¡ç«¯çŸ¥é“è°å‘å‡ºçš„è¿™æ¬¡è¯·æ±‚ã€‚å¦‚æœä½ è¯·æ±‚äº†æ¥å£è¿›è¡Œç™»å½•ï¼ŒæœåŠ¡ç«¯éªŒè¯é€šè¿‡åä¼šåœ¨å“åº”å¤´åŠ å…¥Set-Cookieå­—æ®µï¼Œç„¶åä¸‹æ¬¡å†å‘è¯·æ±‚çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†cookieé™„åŠ åœ¨HTTPè¯·æ±‚çš„å¤´å­—æ®µCookieä¸­ï¼ŒæœåŠ¡ç«¯å°±èƒ½çŸ¥é“è¿™ä¸ªç”¨æˆ·å·²ç»ç™»å½•è¿‡äº†ã€‚çŸ¥é“è¿™ä¸ªä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹åœºæ™¯ï¼š

1.ä½ å‡†å¤‡å»æ¸…ç©ºä½ çš„è´­ç‰©è½¦ï¼Œäºæ˜¯æ‰“å¼€äº†ä¹°ä¹°ä¹°ç½‘ç«™ www.maimaimai.comï¼Œç„¶åç™»å½•æˆåŠŸï¼Œä¸€çœ‹ï¼Œè´­ç‰©è½¦ä¸œè¥¿è¿™ä¹ˆå°‘ï¼Œä¸è¡Œï¼Œè¿˜å¾—ä¹°å¤šç‚¹ã€‚

2.ä½ åœ¨çœ‹æœ‰ä»€ä¹ˆä¸œè¥¿ä¹°çš„è¿‡ç¨‹ä¸­ï¼Œä½ çš„å¥½åŸºå‹å‘ç»™ä½ ä¸€ä¸ªé“¾æ¥ www.nidongde.comï¼Œä¸€è„¸yinç¬‘åœ°è·Ÿä½ è¯´ï¼šâ€œä½ æ‡‚çš„â€ï¼Œä½ æ¯«ä¸çŠ¹è±«æ‰“å¼€äº†ã€‚

3.ä½ é¥¶æœ‰å…´è‡´åœ°æµè§ˆç€ www.nidongde.comï¼Œè°çŸ¥è¿™ä¸ªç½‘ç«™æš—åœ°é‡Œåšäº†äº›ä¸å¯æè¿°çš„äº‹æƒ…ï¼ç”±äºæ²¡æœ‰åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå®ƒå‘www.maimaimai.comå‘èµ·äº†è¯·æ±‚ï¼èªæ˜çš„ä½ ä¸€å®šæƒ³åˆ°ä¸Šé¢çš„è¯â€œæœåŠ¡ç«¯éªŒè¯é€šè¿‡åä¼šåœ¨å“åº”å¤´åŠ å…¥Set-Cookieå­—æ®µï¼Œç„¶åä¸‹æ¬¡å†å‘è¯·æ±‚çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†cookieé™„åŠ åœ¨HTTPè¯·æ±‚çš„å¤´å­—æ®µCookieä¸­â€ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè¿™ä¸ªä¸æ³•ç½‘ç«™å°±ç›¸å½“äºç™»å½•äº†ä½ çš„è´¦å·ï¼Œå¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†ï¼å¦‚æœè¿™ä¸æ˜¯ä¸€ä¸ªä¹°ä¹°ä¹°è´¦å·ï¼Œè€Œæ˜¯ä½ çš„é“¶è¡Œè´¦å·ï¼Œé‚£â€¦â€¦

è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„CSRFæ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€‚

**æ²¡æœ‰åŒæºç­–ç•¥é™åˆ¶çš„DomæŸ¥è¯¢**

1.æœ‰ä¸€å¤©ä½ åˆšç¡é†’ï¼Œæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œè¯´æ˜¯ä½ çš„é“¶è¡Œè´¦å·æœ‰é£é™©ï¼Œèµ¶ç´§ç‚¹è¿›www.yinghang.comæ”¹å¯†ç ã€‚ä½ å“å°¿äº†ï¼Œèµ¶ç´§ç‚¹è¿›å»ï¼Œè¿˜æ˜¯ç†Ÿæ‚‰çš„é“¶è¡Œç™»å½•ç•Œé¢ï¼Œä½ æœæ–­è¾“å…¥ä½ çš„è´¦å·å¯†ç ï¼Œç™»å½•è¿›å»çœ‹çœ‹é’±æœ‰æ²¡æœ‰å°‘äº†ã€‚
2.ç¡çœ¼æœ¦èƒ§çš„ä½ æ²¡çœ‹æ¸…æ¥šï¼Œå¹³æ—¶è®¿é—®çš„é“¶è¡Œç½‘ç«™æ˜¯www.yinhang.comï¼Œè€Œç°åœ¨è®¿é—®çš„æ˜¯www.yinghang.comï¼Œè¿™ä¸ªé’“é±¼ç½‘ç«™åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ

```
// HTML
<iframe name="yinhang" src="www.yinhang.com"></iframe>
// JS
// ç”±äºæ²¡æœ‰åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œé’“é±¼ç½‘ç«™å¯ä»¥ç›´æ¥æ‹¿åˆ°åˆ«çš„ç½‘ç«™çš„Dom
const iframe = window.frames['yinhang']
const node = iframe.document.getElementById('ä½ è¾“å…¥è´¦å·å¯†ç çš„Input')
console.log(`æ‹¿åˆ°äº†è¿™ä¸ª${node}ï¼Œæˆ‘è¿˜æ‹¿ä¸åˆ°ä½ åˆšåˆšè¾“å…¥çš„è´¦å·å¯†ç å—`)
```

ç”±æ­¤æˆ‘ä»¬çŸ¥é“ï¼ŒåŒæºç­–ç•¥ç¡®å®èƒ½è§„é¿ä¸€äº›å±é™©ï¼Œä¸æ˜¯è¯´æœ‰äº†åŒæºç­–ç•¥å°±å®‰å…¨ï¼Œåªæ˜¯è¯´åŒæºç­–ç•¥æ˜¯ä¸€ç§æµè§ˆå™¨æœ€åŸºæœ¬çš„å®‰å…¨æœºåˆ¶ï¼Œæ¯•ç«Ÿèƒ½æé«˜ä¸€ç‚¹æ”»å‡»çš„æˆæœ¬ã€‚å…¶å®æ²¡æœ‰åˆºä¸ç©¿çš„ç›¾ï¼Œåªæ˜¯æ”»å‡»çš„æˆæœ¬å’Œæ”»å‡»æˆåŠŸåè·å¾—çš„åˆ©ç›Šæˆä¸æˆæ­£æ¯”ã€‚

### åŒæºç­–ç•¥é™åˆ¶ä¸‹æ¥å£è¯·æ±‚çš„æ­£ç¡®æ‰“å¼€æ–¹å¼ 
#### 1.JSONP
åœ¨HTMLæ ‡ç­¾é‡Œï¼Œä¸€äº›æ ‡ç­¾æ¯”å¦‚scriptã€imgè¿™æ ·çš„è·å–èµ„æºçš„æ ‡ç­¾æ˜¯æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨jsonpã€‚
jsonpçš„åŸç†ï¼šé€šè¿‡scriptæ ‡ç­¾å¼•å…¥ä¸€ä¸ªjsæ–‡ä»¶ï¼Œè¿™ä¸ªjsæ–‡ä»¶è½½å…¥æˆåŠŸåä¼šæ‰§è¡Œæˆ‘ä»¬åœ¨urlå‚æ•°ä¸­æŒ‡å®šçš„å‡½æ•°ï¼Œå¹¶ä¸”ä¼šæŠŠæˆ‘ä»¬éœ€è¦çš„jsonæ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæœ‰ç§å›è°ƒçš„å‘³é“ï¼

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <script type='text/javascript'>
      // åç«¯è¿”å›ç›´æ¥æ‰§è¡Œçš„æ–¹æ³•ï¼Œç›¸å½“äºæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œç”±äºåç«¯æŠŠè¿”å›çš„æ•°æ®æ”¾åœ¨æ–¹æ³•çš„å‚æ•°é‡Œï¼Œæ‰€ä»¥è¿™é‡Œèƒ½æ‹¿åˆ°resã€‚
      window.jsonpCb = function (res) {
        console.log(res)
      }
    </script>
    <script src='http://localhost:9871/api/jsonp?msg=helloJsonp&callback=jsonpCb' type='text/javascript'></script>
  </body>
</html>
```
ç®€å•å°è£…ä¸€ä¸‹å‰ç«¯è¿™ä¸ªå¥—è·¯
```js
/**
 * JSONPè¯·æ±‚å·¥å…·
 * @param url è¯·æ±‚çš„åœ°å€
 * @param data è¯·æ±‚çš„å‚æ•°
 * @returns {Promise<any>}
 */
const request = ({url, data}) => {
  return new Promise((resolve, reject) => {
    // å¤„ç†ä¼ å‚æˆxx=yy&aa=bbçš„å½¢å¼
    const handleData = (data) => {
      const keys = Object.keys(data)
      const keysLen = keys.length
      return keys.reduce((pre, cur, index) => {
        const value = data[cur]
        const flag = index !== keysLen - 1 ? '&' : ''
        return `${pre}${cur}=${value}${flag}`
      }, '')
    }
    // åŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾
    const script = document.createElement('script')
    // æ¥å£è¿”å›çš„æ•°æ®è·å–
    window.jsonpCb = (res) => {
      document.body.removeChild(script)
      delete window.jsonpCb
      resolve(res)
    }
    script.src = `${url}?${handleData(data)}&cb=jsonpCb`
    document.body.appendChild(script)
  })
}
// ä½¿ç”¨æ–¹å¼
request({
  url: 'http://localhost:9871/api/jsonp',
  data: {
    // ä¼ å‚
    msg: 'helloJsonp'
  }
}).then(res => {
  console.log(res)
})
```

JSONPçš„ä¼˜ç¼ºç‚¹
ä¼˜ç‚¹ï¼šå®ƒä¸åƒXMLHttpRequestå¯¹è±¡å®ç°çš„Ajaxè¯·æ±‚é‚£æ ·å—åˆ°åŒæºç­–ç•¥çš„é™åˆ¶ï¼›å®ƒçš„å…¼å®¹æ€§æ›´å¥½ï¼Œåœ¨æ›´åŠ å¤è€çš„æµè§ˆå™¨ä¸­éƒ½å¯ä»¥è¿è¡Œï¼Œä¸éœ€è¦XMLHttpRequestæˆ–ActiveXçš„æ”¯æŒï¼›å¹¶ä¸”åœ¨è¯·æ±‚å®Œæ¯•åå¯ä»¥é€šè¿‡è°ƒç”¨callbackçš„æ–¹å¼å›ä¼ ç»“æœã€‚

ç¼ºç‚¹ï¼šå®ƒåªæ”¯æŒGETè¯·æ±‚è€Œä¸æ”¯æŒPOSTç­‰å…¶å®ƒç±»å‹çš„HTTPè¯·æ±‚ï¼›å®ƒåªæ”¯æŒè·¨åŸŸHTTPè¯·æ±‚è¿™ç§æƒ…å†µï¼Œä¸èƒ½è§£å†³ä¸åŒåŸŸçš„ä¸¤ä¸ªé¡µé¢ä¹‹é—´å¦‚ä½•è¿›è¡ŒJavaScriptè°ƒç”¨çš„é—®é¢˜ã€‚

#### 2.ç©ºiframeåŠ form
iframeå¯ä»¥å‘POSTè¯·æ±‚
```js
const requestPost = ({url, data}) => {
  // é¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨æ¥å‘é€æ•°æ®çš„iframe.
  const iframe = document.createElement('iframe')
  iframe.name = 'iframePost'
  iframe.style.display = 'none'
  document.body.appendChild(iframe)
  const form = document.createElement('form')
  const node = document.createElement('input')
  // æ³¨å†Œiframeçš„loadäº‹ä»¶å¤„ç†ç¨‹åº,å¦‚æœä½ éœ€è¦åœ¨å“åº”è¿”å›æ—¶æ‰§è¡Œä¸€äº›æ“ä½œçš„è¯.
  iframe.addEventListener('load', function () {
    console.log('post success')
  })

  form.action = url
  // åœ¨æŒ‡å®šçš„iframeä¸­æ‰§è¡Œform
  form.target = iframe.name
  form.method = 'post'
  for (let name in data) {
    node.name = name
    node.value = data[name].toString()
    form.appendChild(node.cloneNode())
  }
  // è¡¨å•å…ƒç´ éœ€è¦æ·»åŠ åˆ°ä¸»æ–‡æ¡£ä¸­.
  form.style.display = 'none'
  document.body.appendChild(form)
  form.submit()

  // è¡¨å•æäº¤å,å°±å¯ä»¥åˆ é™¤è¿™ä¸ªè¡¨å•,ä¸å½±å“ä¸‹æ¬¡çš„æ•°æ®å‘é€.
  document.body.removeChild(form)
}
// ä½¿ç”¨æ–¹å¼
requestPost({
  url: 'http://localhost:9871/api/iframePost',
  data: {
    msg: 'helloIframePost'
  }
})
```

#### 3.CORS
CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯"è·¨åŸŸèµ„æºå…±äº«"ï¼ˆCross-origin resource sharing)ã€‚CORSæœ‰ä¸¤ç§è¯·æ±‚ï¼Œç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ï¼š
åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚

(1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š
* HEAD
* GET
* POST

(2)HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š
* Accept
* Accept-Language
* Content-Language
* Last-Event-ID
* Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain

**ç®€å•è¯·æ±‚:**

å‰ç«¯ä»€ä¹ˆä¹Ÿä¸ç”¨å¹²ï¼Œå°±æ˜¯æ­£å¸¸å‘è¯·æ±‚å°±å¯ä»¥,å¤§éƒ¨åˆ†è¿˜æ˜¯åç«¯äººå‘˜çš„å·¥ä½œã€‚

æµè§ˆå™¨ï¼šè¯¶ï¼Œä½ å°å­è¦è·¨åŸŸæ˜¯å§ï¼Œæˆ‘å¾—é—®é—®æœåŠ¡å™¨å¤§å“¥è‚¯ä¸è‚¯ï¼å¾€è¯·æ±‚å¤´æ·»åŠ originäº®ä¸€ä¸‹ç‰Œé¢ã€‚

<img :src="('/images/è·¨åŸŸ/è¯·æ±‚å¤´Origin.png')">

![git å¸¸ç”¨å‘½ä»¤](/images/è·¨åŸŸ/è¯·æ±‚å¤´Origin.png)

æœåŠ¡å™¨ï¼šè¯¶ï¼Œä½ æ˜¯è°ï¼Œæˆ‘æ¥çœ‹çœ‹ä½ çš„originï¼Œå—¯å—¯ï¼Œå¯ä»¥ï¼Œç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œæ”¾è¡Œï¼é¡ºä¾¿å‘Šè¯‰ä½ ï¼Œè€å¤«çš„è§„çŸ©ï¼

<img :src="('/images/è·¨åŸŸ/è¿”å›å¤´.png')">

`Access-Control-Allow-Origin`æœ‰å¤šç§è®¾ç½®æ–¹æ³•ï¼š
* è®¾ç½®*æ˜¯æœ€ç®€å•ç²—æš´çš„ï¼Œä½†æ˜¯æœåŠ¡å™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè‚¯å®šä¸ä¼šè¿™ä¹ˆå¹²ï¼Œè€Œä¸”ï¼Œå¦‚æœæ˜¯*çš„è¯ï¼Œæ¸¸è§ˆå™¨å°†ä¸ä¼šå‘é€cookies.å³ä½¿ä½ çš„XHRè®¾ç½®äº†withCredentials
* æŒ‡å®šåŸŸï¼Œå¦‚ä¸Šå›¾ä¸­çš„http://172.20.0.206

`withCredentials`ï¼šè¡¨ç¤ºXHRæ˜¯å¦æ¥æ”¶cookieså’Œå‘é€cookiesï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè¯¥å€¼æ˜¯falseï¼Œå“åº”å¤´çš„`Set-Cookie`ï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šç†ï¼Œå¹¶ä¸”å³ä½¿æœ‰ç›®æ ‡ç«™ç‚¹çš„cookiesï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚

**å¤æ‚è¯·æ±‚:**

æœ€å¸¸è§çš„æƒ…å†µï¼Œå½“æˆ‘ä»¬ä½¿ç”¨putå’Œdeleteè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€optionï¼ˆé¢„æ£€ï¼‰è¯·æ±‚ï¼Œä¸è¿‡æœ‰æ—¶å€™ï¼Œä½ ä¼šå‘ç°å¹¶æ²¡æœ‰ï¼Œè¿™æ˜¯åé¢ä¼šè®²åˆ°ç¼“å­˜ã€‚
éç®€å•è¯·æ±‚ä¼šå‘å‡ºä¸€æ¬¡é¢„æ£€æµ‹è¯·æ±‚ï¼Œè¿”å›ç æ˜¯204ï¼Œé¢„æ£€æµ‹é€šè¿‡æ‰ä¼šçœŸæ­£å‘å‡ºè¯·æ±‚ï¼Œè¿™æ‰è¿”å›200ã€‚

ä¸ç®€å•è¯·æ±‚ä¸åŒçš„æ˜¯ï¼Œoptionè¯·æ±‚å¤šäº†2ä¸ªå­—æ®µï¼š
`Access-Control-Request-Method`ï¼šè¯¥æ¬¡è¯·æ±‚çš„è¯·æ±‚æ–¹å¼
`Access-Control-Request-Headers`ï¼šè¯¥æ¬¡è¯·æ±‚çš„è‡ªå®šä¹‰è¯·æ±‚å¤´å­—æ®µ

```
//æŒ‡å®šå…è®¸å…¶ä»–åŸŸåè®¿é—®
'Access-Control-Allow-Origin:http://172.20.0.206'//ä¸€èˆ¬ç”¨æ³•ï¼ˆ*ï¼ŒæŒ‡å®šåŸŸï¼ŒåŠ¨æ€è®¾ç½®ï¼‰ï¼Œ3æ˜¯å› ä¸º*ä¸å…è®¸æºå¸¦è®¤è¯å¤´å’Œcookies
//æ˜¯å¦å…è®¸åç»­è¯·æ±‚æºå¸¦è®¤è¯ä¿¡æ¯ï¼ˆcookiesï¼‰,è¯¥å€¼åªèƒ½æ˜¯true,å¦åˆ™ä¸è¿”å›
'Access-Control-Allow-Credentials:true'
//é¢„æ£€ç»“æœç¼“å­˜æ—¶é—´,ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´åˆ°çš„ç¼“å­˜å•¦
'Access-Control-Max-Age: 1800'
//å…è®¸çš„è¯·æ±‚ç±»å‹
'Access-Control-Allow-Methods:PUT,POST,GET,DELETE,OPTIONS'
//å…è®¸çš„è¯·æ±‚å¤´å­—æ®µ
'Access-Control-Allow-Headers:x-requested-with,content-type'
```

#### 4.ä»£ç†

æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¯·æ±‚çš„æ—¶å€™è¿˜æ˜¯ç”¨å‰ç«¯çš„åŸŸåï¼Œç„¶åæœ‰ä¸ªä¸œè¥¿å¸®æˆ‘ä»¬æŠŠè¿™ä¸ªè¯·æ±‚è½¬å‘åˆ°çœŸæ­£çš„åç«¯åŸŸåä¸Šï¼Œä¸å°±é¿å…è·¨åŸŸäº†å—ï¼Ÿ

å¦‚GISä¸“ä¸šæœ€å¸¸æ¥è§¦çš„esriä»£ç†ï¼Œåªè¦é…ç½®ä¸€ä¸‹éœ€è¦ä»£ç†çš„åœ°å€ï¼Œå‰ç«¯å°±ä¸ç”¨å¹²ä»€ä¹ˆäº‹æƒ…äº†ï¼Œä¹Ÿæ²¡åç«¯ä»€ä¹ˆäº‹æƒ…äº†

### åŒæºç­–ç•¥é™åˆ¶ä¸‹DomæŸ¥è¯¢çš„æ­£ç¡®æ‰“å¼€æ–¹å¼

#### 1.postMessage

window.postMessage() æ˜¯HTML5çš„ä¸€ä¸ªæ¥å£ï¼Œä¸“æ³¨å®ç°ä¸åŒçª—å£ä¸åŒé¡µé¢çš„è·¨åŸŸé€šè®¯ã€‚

è¿™é‡Œæ˜¯http://localhost:9099/#/crossDomainï¼Œå‘æ¶ˆæ¯æ–¹

```vue
<template>
  <div>
    <button @click="postMessage">ç»™http://crossDomain.com:9099å‘æ¶ˆæ¯</button>
    <iframe name="crossDomainIframe" src="http://crossdomain.com:9099"></iframe>
  </div>
</template>

<script>
export default {
  mounted () {
    window.addEventListener('message', (e) => {
      // è¿™é‡Œä¸€å®šè¦å¯¹æ¥æºåšæ ¡éªŒ
      if (e.origin === 'http://crossdomain.com:9099') {
        // æ¥è‡ªhttp://crossdomain.com:9099çš„ç»“æœå›å¤
        console.log(e.data)
      }
    })
  },
  methods: {
    // å‘http://crossdomain.com:9099å‘æ¶ˆæ¯
    postMessage () {
      const iframe = window.frames['crossDomainIframe']
      iframe.postMessage('æˆ‘æ˜¯[http://localhost:9099], éº»çƒ¦ä½ æŸ¥ä¸€ä¸‹ä½ é‚£è¾¹æœ‰æ²¡æœ‰idä¸ºappçš„Dom', 'http://crossdomain.com:9099')
    }
  }
}
</script>
```

è¿™é‡Œæ˜¯http://crossdomain.com:9099ï¼Œæ¥æ”¶æ¶ˆæ¯æ–¹

```
<template>
  <div>
    <button @click="postMessage">ç»™http://crossDomain.com:9099å‘æ¶ˆæ¯</button>
    <iframe name="crossDomainIframe" src="http://crossdomain.com:9099"></iframe>
  </div>
</template>

<script>
export default {
  mounted () {
    window.addEventListener('message', (e) => {
      // è¿™é‡Œä¸€å®šè¦å¯¹æ¥æºåšæ ¡éªŒ
      if (e.origin === 'http://crossdomain.com:9099') {
        // æ¥è‡ªhttp://crossdomain.com:9099çš„ç»“æœå›å¤
        console.log(e.data)
      }
    })
  },
  methods: {
    // å‘http://crossdomain.com:9099å‘æ¶ˆæ¯
    postMessage () {
      const iframe = window.frames['crossDomainIframe']
      iframe.postMessage('æˆ‘æ˜¯[http://localhost:9099], éº»çƒ¦ä½ æŸ¥ä¸€ä¸‹ä½ é‚£è¾¹æœ‰æ²¡æœ‰idä¸ºappçš„Dom', 'http://crossdomain.com:9099')
    }
  }
}
</script>
```

#### 2.document.domain

è¿™ç§æ–¹å¼åªé€‚åˆä¸»åŸŸåç›¸åŒï¼Œä½†å­åŸŸåä¸åŒçš„iframeè·¨åŸŸã€‚

åˆ†äº«å‡ ä¸ªä¾‹å­ï¼š

* 1.è®¿é—®åŒæºé¡µé¢ï¼š

æ‰“å¼€https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cookieï¼Œåœ¨f12æ§åˆ¶å°é‡Œwindow.opené¡µé¢ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headersï¼Œè®¿é—®è¿”å›çš„windowå¯¹è±¡çš„documentå±æ€§ï¼Œå‘ç°èƒ½å¤Ÿè®¿é—®æˆåŠŸï¼Œå¦‚ä¸‹å›¾ï¼š

<img :src="('/images/è·¨åŸŸ/åŒæºé¡µé¢.jpg')">

* 2.è®¿é—®åè®®ã€ç«¯å£å·ä¸€è‡´ï¼ŒåŸŸåä¸ä¸€è‡´ï¼Œä½†å…·æœ‰ç›¸åŒä¸Šçº§åŸŸåçš„é¡µé¢

æ‰“å¼€id.qq.comï¼Œf12æ‰“å¼€æ§åˆ¶å°ï¼Œwindow.opené¡µé¢: www.qq.comï¼ŒåŒæ ·è®¿é—®è¿”å›çš„windowå¯¹è±¡çš„documentå±æ€§ï¼Œå‘ç°è®¿é—®å¤±è´¥ï¼Œæç¤ºè¢«é˜»æ­¢è®¿é—®è·¨åŸŸçš„çª—ä½“ï¼š

<img :src="('/images/è·¨åŸŸ/è¢«é˜»æ­¢è®¿é—®è·¨åŸŸ.jpg')">

è¿™ä¸ªæ—¶å€™åˆ†åˆ«æ‰“å°id.qq.comçš„document.domainå’Œwww.qq.comçš„document.domainï¼Œå‘ç°å‰è€…æ˜¯id.qq.comï¼Œè€Œåè€…æ˜¯qq.comï¼Œè¿™æ—¶æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹id.qq.comé¡µé¢çš„document.domainï¼Œè®¾ç½®ä¸ºqq.comï¼Œå†æ¬¡è®¿é—®www.qq.comçš„windowå¯¹è±¡çš„documentï¼Œå‘ç°è®¿é—®æˆåŠŸï¼š

<img :src="('/images/è·¨åŸŸ/è®¿é—®æˆåŠŸ.jpg')">

#### 3.canvasæ“ä½œå›¾ç‰‡çš„è·¨åŸŸé—®é¢˜

* 1.é¦–å…ˆï¼Œå›¾ç‰‡æœåŠ¡å™¨éœ€è¦é…ç½®Access-Control-Allow-Origin

å½“éœ€è¦éœ€è¦å¯¹canvaså›¾ç‰‡è¿›è¡ŒgetImageData()æˆ–toDataURL()æ“ä½œçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œè€Œä¸”è·¨åŸŸé—®é¢˜è¿˜ä¸æ­¢ä¸€å±‚ã€‚

å›¾ç‰‡æœåŠ¡å™¨éœ€è¦é…ç½®Access-Control-Allow-Originä¿¡æ¯ï¼Œæ­¤æ—¶ï¼ŒChromeæµè§ˆå™¨å°±ä¸ä¼šæœ‰Access-Control-Allow-Originç›¸å…³çš„é”™è¯¯ä¿¡æ¯äº†ï¼Œä½†æ˜¯ï¼Œè¿˜ä¼šæœ‰å…¶ä»–çš„è·¨åŸŸé”™è¯¯ä¿¡æ¯ã€‚

* 2.HTML crossOriginå±æ€§è§£å†³èµ„æºè·¨åŸŸé—®é¢˜

```js
img = new Image();
img.setAttribute("crossOrigin", "Anonymous");
```

å…³äº crossOriginï¼Œæˆ‘ä»¬çœ‹çœ‹ MDN çš„è§£é‡Šã€‚

<img :src="('/images/è·¨åŸŸ/crossOrigin.jpg')">

è¿™æ®µè¯ï¼Œç”¨æˆ‘è‡ªå·±çš„ç†è§£æ¥è§£é‡Šä¸€ä¸‹ï¼š

åŠ äº† crossorigin å±æ€§ï¼Œåˆ™è¡¨æ˜å›¾ç‰‡å°±ä¸€å®šä¼šæŒ‰ç…§ CORS æ¥è¯·æ±‚å›¾ç‰‡ã€‚è€Œé€šè¿‡CORS è¯·æ±‚åˆ°çš„å›¾ç‰‡å¯ä»¥å†æ¬¡è¢«å¤ç”¨åˆ° canvas ä¸Šè¿›è¡Œç»˜åˆ¶ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœä¸åŠ  crossorigin å±æ€§çš„è¯ï¼Œé‚£ä¹ˆå›¾ç‰‡æ˜¯ä¸èƒ½å†æ¬¡è¢«å¤ç”¨åˆ° canvas ä¸Šå»çš„ã€‚
å¯ä»¥è®¾ç½®çš„å€¼æœ‰ anonymous ä»¥åŠ use-credentialsï¼Œ2 ä¸ª value çš„ä½œç”¨éƒ½æ˜¯è®¾ç½®é€šè¿‡ CORS æ¥è¯·æ±‚å›¾ç‰‡ï¼ŒåŒºåˆ«åœ¨äº use-credentials æ˜¯åŠ äº†è¯ä¹¦çš„ CORSã€‚
å¦‚æœé»˜è®¤ç”¨æˆ·ä¸è¿›è¡Œä»»ä½•è®¾ç½®ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‘èµ· CORS è¯·æ±‚ã€‚ä½†å¦‚æœè®¾ç½®äº†é™¤ anonymous å’Œ use-credentials ä»¥å¤–çš„å…¶ä»–å€¼ï¼ŒåŒ…æ‹¬ç©ºå­—ä¸²åœ¨å†…ï¼Œé»˜è®¤ä¼šå½“ä½œ anonymousæ¥å¤„ç†ã€‚

å‚è€ƒæ–‡ç« ï¼š

- [ä¸è¦å†é—®æˆ‘è·¨åŸŸçš„é—®é¢˜äº†](https://segmentfault.com/a/1190000015597029)
- [æ²¡é”™ï¼Œå°±æ˜¯Access-Control-Allow-Originï¼Œè·¨åŸŸ](https://www.jianshu.com/p/89a377c52b48)
- [ä¸€ä¸ªå…³äºimageè®¿é—®å›¾ç‰‡è·¨åŸŸçš„é—®é¢˜](https://www.jianshu.com/p/8fa0fb53c183)
- [canvaså›¾ç‰‡é—®é¢˜æµ…æ](https://www.jianshu.com/p/c3aa975923de)


### arcgis API ä¸­rendererç±»çš„ä½¿ç”¨

#### SimpleRendererï¼ˆç®€å•æ¸²æŸ“ï¼‰

```js
require(["esri/renderers/SimpleRenderer"], function(SimpleRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯:
ç»™å›¾å±‚çš„è¦ç´ ç»Ÿä¸€è®¾ç½®å›ºå®šçš„æ¸²æŸ“æ–¹æ¡ˆ

**API 3.28**
SimpleRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š

å€¼|ç±»å‹|æè¿°
-|-|-
symbol|Symbol|æ¸²æŸ“çš„ç¬¦å·
visualVariables|Object[]|è®¾ç½®é¢œè‰²ï¼Œé€æ˜åº¦ï¼Œå¤§å°ï¼Œå’Œæ—‹è½¬åº¦


ä½¿ç”¨æ¡ˆä¾‹ï¼š
```js
var renderer = new SimpleRenderer(symbol);

renderer.setVisualVariables([{
    type: "sizeInfo",
    field: "field",
    minSize: 5,
    maxSize: 50,
    minDataValue: 50,
    maxDataValue: 1000
  }]);
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š
åŠ¨æ€å›¾å±‚ï¼ˆArcGISDynamicMapServiceLayerï¼‰ä¸­çš„LayerDrawingOptionså±æ€§è®¾ç½®visualVariablesæ˜¯æ— æ•ˆçš„ï¼Œä¼šè¢«å¿½ç•¥

#### ClassBreaksRendererï¼ˆåˆ†çº§æ¸²æŸ“ï¼‰

```js
require(["esri/renderers/ClassBreaksRenderer"], function(ClassBreaksRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯:
æ ¹æ®ç»™å®šçš„å…·ä½“æŸä¸ªå±æ€§å­—æ®µï¼Œæ ¹æ®è¯¥å­—æ®µçš„å€¼è¿›è¡Œæ¢¯åº¦åˆ†ç±»ï¼Œç”¨ä¸åŒç¬¦å·çš„åˆ†ç±»æ¸²æŸ“ã€‚

**API 3.28**
ClassBreaksRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š
å€¼|ç±»å‹|æè¿°
-|-|-
attributeField|String|æ¸²æŸ“å™¨åŒ¹é…çš„å±æ€§å­—æ®µ
defaultSymbol |Symbol|æ— æ³•åŒ¹é…å€¼æˆ–ä¸­æ–­æ—¶ä½¿ç”¨çš„é»˜è®¤ç¬¦å·ã€‚
infos|Object[]|åˆ†çº§æ¸²æŸ“é…ç½®
isMaxInclusive|Boolean|åˆ†çº§æ¸²æŸ“å€¼ä¸ŠåŒ…å«ï¼ˆé»˜è®¤trueï¼‰
normalizationType|	String|æŒ‡ç¤ºå¦‚ä½•è§„èŒƒåŒ–æ•°æ®ã€‚
normalizationTotal |	Number|æ€»å€¼
normalizationField|String|attributeFieldå±æ€§çš„å­—æ®µä¼šé™¤è¿™ä¸ªå­—æ®µ
visualVariables|Object[]|è®¾ç½®é¢œè‰²ï¼Œé€æ˜åº¦ï¼Œå¤§å°ï¼Œå’Œæ—‹è½¬åº¦

ä½¿ç”¨æ¡ˆä¾‹ï¼š
```js
var renderer = new ClassBreaksRenderer(defaultSymbol, attributeField);

renderer.addBreak(0, 25, new SimpleFillSymbol().setColor(new Color([56, 168, 0, 0.5])));
renderer.addBreak(25, 75, new SimpleFillSymbol().setColor(new Color([139, 209, 0, 0.5])));

// å¦‚æœä½¿ç”¨normalizationType
// Breakçš„å€¼å°†ä¼šæ”¹å˜

// normalizationTotalæ˜¯æ‰€æœ‰è¦ç´ attributeFieldå­—æ®µçš„æ€»å’Œ
// åˆ¤æ–­çš„Breakçš„å€¼å°†å˜æˆ attributeField/normalizationTotal*100

// renderer.normalizationType = "percent-of-total";
// renderer.normalizationTotal = 1000;

// attributeFieldå°†ä¼šé™¤normalizationFieldå­—æ®µ
// åˆ¤æ–­çš„Breakçš„å€¼å°†å˜æˆ attributeField/normalizationField
renderer.normalizationType = "field";
renderer.normalizationField = "normalizationField";
```

#### UniqueValueRendererï¼ˆå”¯ä¸€å€¼æ¸²æŸ“ï¼‰

```js
require(["esri/renderers/UniqueValueRenderer"], function(UniqueValueRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯:
æ ¹æ®ç»™å®šçš„å…·ä½“ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§å­—æ®µï¼Œæ ¹æ®è¿™äº›å­—æ®µçš„å€¼ï¼Œå¯¹æ¯ä¸€ç»„å”¯ä¸€çš„å€¼è¿›è¡Œä¸åŒç¬¦å·çš„åˆ†ç±»æ¸²æŸ“ã€‚

**API 3.28**
UniqueValueRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š
å€¼|ç±»å‹|æè¿°
-|-|-
attributeField|String|æ¸²æŸ“å™¨åŒ¹é…çš„å±æ€§å­—æ®µ
defaultSymbol |Symbol|æ— æ³•åŒ¹é…å€¼æˆ–ä¸­æ–­æ—¶ä½¿ç”¨çš„é»˜è®¤ç¬¦å·ã€‚
fieldDelimiter|String|å¦‚æœæŒ‡å®šäº†å¤šä¸ªå±æ€§å­—æ®µï¼Œå€¼ä¹‹é—´çš„åˆ†éš”ç¬¦
infos|Object[]|å”¯ä¸€å€¼æ¸²æŸ“é…ç½®
valueExpression|String|ä¸€ä¸ªArcadeè¡¨è¾¾å¼ï¼Œå…¶å€¼ä¸ºå­—ç¬¦ä¸²æˆ–æ•°å­—ã€‚
visualVariables|Object[]|è®¾ç½®é¢œè‰²ï¼Œé€æ˜åº¦ï¼Œå¤§å°ï¼Œå’Œæ—‹è½¬åº¦

- [valueExpressionä½¿ç”¨ä»‹ç»](http://localhost/arcgis_js_v328_sdk/arcgis_js_api/sdk/jssamples/renderer_arcade.html)

ä½¿ç”¨æ¡ˆä¾‹ï¼š
```js
var Options = {
  outFields: ["attributeField1", "attributeField2", "attributeField3", "attributeField4"],
};

  var uniqueValueRenderer = new UniqueValueRenderer(createSymbol("#d9d9d9"), function (graphic){
  var maxField = "Other";
  var max = 0;

  array.forEach(Options.outFields, function (field){
    if (graphic.attributes[field] > max) {
      maxField = field;
      max = graphic.attributes[field];
    }});

    return maxField;
  });

  function createSymbol(color){
    return new SimpleFillSymbol().setColor(new Color(color)).setOutline(
      new SimpleLineSymbol().setColor(new Color("#999999")).setWidth(1));
    }

  uniqueValueRenderer.addValue({ value: "attributeField1", symbol: createSymbol("#fd7f6f"), label: "Vegetables" });
  uniqueValueRenderer.addValue({ value: "attributeField2", symbol: createSymbol("#b2e061"), label: "Cotton" });
  uniqueValueRenderer.addValue({ value: "attributeField3", symbol: createSymbol("#bd7ebe"), label: "Wheat" });
  uniqueValueRenderer.addValue({ value: "attributeField4", symbol: createSymbol("#7eb0d5"), label: "Soybeans" });
```

#### BlendRendererï¼ˆæ··åˆæ¸²æŸ“ï¼‰

```
require(["esri/renderers/BlendRenderer"], function(BlendRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯ï¼š
å¯¹äºå­˜åœ¨ä¸¤ä¸ªæˆ–ä»¥ä¸Šå…·æœ‰ç›¸äº’ç«äº‰çš„å±æ€§å­—æ®µï¼Œä½¿ç”¨æ··åˆæ¸²æŸ“å¯ä»¥ç»™æ¯ä¸ªå±æ€§éƒ½åˆ†é…æœ‰å”¯ä¸€çš„é¢œè‰²ï¼Œå¹¶æ ¹æ®å±æ€§å­—æ®µå€¼çš„å¤§å°è®¡ç®—å‡ºç›¸åº”çš„é€æ˜åº¦ï¼Œæœ€åè¿›è¡Œé¢œè‰²æ··åˆã€‚æ‰€ä»¥ï¼Œå±æ€§å€¼è¶Šé«˜ï¼Œé¢œè‰²è¶Šå ä¼˜åŠ¿ã€‚

**API 3.28**
BlendRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š
å€¼|ç±»å‹|æè¿°
-|-|-
blendMode|String|å†³å®šé¢œè‰²æ˜¯å¦‚ä½•æ··åˆåœ¨ä¸€èµ·
fields|Object[]|ä¸åŒå±æ€§å¯¹åº”çš„é¢œè‰²
opacityStops|Object[]|å€¼å æ¯”ä¸é€æ˜åº¦å¯¹åº”çš„è®¾ç½®
normalizationField|String| å‡ ä¸ªç«äº‰å­—æ®µçš„æ€»è®¡å€¼
symbol |Symbol|å¯¹åº”çš„æ¸²æŸ“ç¬¦å·

- [å…³äºblendModeæ›´å¤šä¿¡æ¯](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types)



æ¡ˆä¾‹ï¼š
```js
var blendRendererOptions = {
  blendMode: "darken", 
  symbol: new SimpleFillSymbol().setOutline(new SimpleLineSymbol().setWidth(1)),
  fields: [
    {
      field: "VALUE1",
      color: new Color([230, 0, 0])
    }, {
      field: "VALUE2",
      color: new Color([56, 168, 0])
    }
  ],
  opacityStops: [
    {
      value: 0,
      opacity: 0
    },
    {
      value: 1,
      opacity: 1
    }
  ],
  normalizationField: "Total"
};

renderer = new BlendRenderer(blendRendererOptions);
```

æ³¨ï¼šåœ¨4.11çš„APIä¸­æš‚æ— è¯¥æ¸²æŸ“åŠŸèƒ½

#### HeatmapRendererï¼ˆçƒ­åŠ›å›¾æ¸²æŸ“ï¼‰

```js
require(["esri/renderers/HeatmapRenderer"], function(HeatmapRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯:
åœ¨ç‚¹è¦ç´ çš„æ¸²æŸ“ä¸­ï¼Œé€šè¿‡æ ¹æ®æ¯ä¸ªç‚¹çš„ä½ç½®ï¼Œä»¥åŠå…¶å½±å“çš„èŒƒå›´ï¼Œå¹¶ä¸”äº’ç›¸å åŠ ï¼Œæ¸²æŸ“æˆä¸€å¹…çƒ­åŠ›å›¾ã€‚

**API 3.28**
HeatmapRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š

å€¼|ç±»å‹|æè¿°
-|-|-
blurRadius|Number|æ¯ä¸ªç‚¹çš„å½±åƒèŒƒå›´ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ã€‚
colorStops|Object[]|æŒ‰æ¯”ä¾‹å»æè¿°æ¸²æŸ“å™¨çš„é¢œè‰²æ¸å˜ã€‚
colors|String[]|æè¿°æ¸²æŸ“å™¨çš„é¢œè‰²æ¸å˜ã€‚
field|String|ç”¨äºçƒ­åŠ›ç‚¹åŠ æƒçš„å±æ€§å­—æ®µã€‚
maxPixelIntensity|Number|åœ¨è‰²å¸¦ä¸­ä¸ºæœ€ç»ˆé¢œè‰²åˆ†é…çš„åƒç´ å¼ºåº¦å€¼ã€‚
minPixelIntensity|Number|åœ¨è‰²å¸¦ä¸­ä¸ºåˆå§‹å¼ºåº¦åˆ†é…çš„åƒç´ å¼ºåº¦å€¼ã€‚ï¼ˆä¸€èˆ¬å¤§äºé›¶ï¼‰


ä½¿ç”¨æ¡ˆä¾‹ï¼š
```js
var heatmapRenderer = new HeatmapRenderer({
  field: "Magnitude",
  blurRadius: 12,
  colorStops: [
    { ratio: 0, color: "rgba(250, 0, 0, 0)" },
    { ratio: 0.6, color: "rgb(250, 0, 0)" },
    { ratio: 0.85, color: "rgb(250, 150, 0)"},
    { ratio: 0.95, color: "rgb(255, 255, 0)"}],
  maxPixelIntensity: 100,
  minPixelIntensity: 10
});
```

#### DotDensityRendererï¼ˆç‚¹å¯†åº¦æ¸²æŸ“ï¼‰

```js
require(["esri/renderers/DotDensityRenderer"], function(DotDensityRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯:
åœ¨é¢è¦ç´ çš„æ¸²æŸ“ä¸­ï¼Œé€šè¿‡é¢å†…ç‚¹çš„å¯†é›†ç¨‹åº¦æ¥è¡¨ç¤ºæŸä¸ªå±æ€§å­—æ®µçš„å¤§å°ã€‚

**API 3.28**
DotDensityRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š
å€¼|ç±»å‹|æè¿°
-|-|-
backgroundColor|Color|é¢è¦ç´ çš„èƒŒæ™¯è‰²
dotShape|String|ç‚¹æ ·å¼
dotSize|Number|ç‚¹å¤§å°
dotValue|Number|ä¸€ä¸ªç‚¹ä»£è¡¨çš„å€¼
fields|Object[]|å®šä¹‰è¦æ˜ å°„çš„å­—æ®µåŠå…¶é¢œè‰²
outline|LineSymbol|ç‚¹çš„å¤–æ¡†


ä½¿ç”¨æ¡ˆä¾‹ï¼š
```js
new DotDensityRenderer({
  fields: [{
    name: "M163_07",
    color: new Color("#CC8800")
  }],
  dotValue: 1600,
  dotSize: 1
  })
```

**API 4.11 çš„ä¸åŒä¹‹å¤„**

åœ¨4.11çš„ç‰ˆæœ¬ä¸­ï¼Œæ›´æ–°äº†DotDensityRendererè¿™ä¸ªæ¸²æŸ“ç±»å‹ï¼Œå…¶æä¾›äº†ä¸¤ä¸ªæ–°çš„å±æ€§ï¼Œæ˜¯åœ¨3.28é‡Œæ²¡æœ‰çš„ï¼Œä¹Ÿæ¯”3.28çš„æ›´å¥½ç”¨äº†ã€‚

å€¼|ç±»å‹|æè¿°
-|-|-
dotBlendingEnabled|Boolean|å½“è®¾ç½®äº†å¤šä¸ªfieldsçš„æ—¶å€™ï¼Œé¢œè‰²æ˜¯è¦†ç›–è¿˜æ˜¯å åŠ 
referenceScale|Number|æ¸²æŸ“å™¨å°†æ ¹æ®ä½¿ç”¨calculateDotValueï¼ˆï¼‰æ–¹æ³•æ ¹æ®åœ°å›¾æ¯”ä¾‹çš„å˜åŒ–çº¿æ€§åœ°é‡æ–°è®¡ç®—ç‚¹å€¼ï¼Œä¹Ÿå³æ˜¯dotValue

#### ScaleDependentRendererï¼ˆä¸åŒæ¯”ä¾‹å°ºä¸åŒæ¸²æŸ“ï¼‰

```js
require(["esri/renderers/ScaleDependentRenderer"], function(ScaleDependentRenderer) { /* code goes here */ });
```

ä½¿ç”¨åœºæ™¯:
åœ¨ä¸åŒçš„åœ°å›¾æ¯”ä¾‹å°ºä¸­ï¼Œæ‰§è¡Œä¸åŒçš„æ¸²æŸ“æ–¹å¼ã€‚

**API 3.28**
HeatmapRendererå¸¸ç”¨å±æ€§ä»‹ç»ï¼š

å€¼|ç±»å‹|æè¿°
-|-|-
rangeType|String|åˆ¤æ–­ä¾æ®æ˜¯zoomè¿˜æ˜¯scale
rendererInfos|Object|å®šä¹‰ä¸åŒç¼©æ”¾æ¯”ä¾‹çš„æ¸²æŸ“


ä½¿ç”¨æ¡ˆä¾‹ï¼š
```js
var renderer1 = new DotDensityRenderer({
  fields: [{
    name: "M163_07",
    color: new Color([52, 114, 53])
  }],
  dotValue: 4000,
  dotSize: 2
});

var renderer2 = new DotDensityRenderer({
  fields: [{
    name: "M163_07",
    color: new Color([52, 114, 53])
  }],
  dotValue: 1000,
  dotSize: 2
});

var scaleDependentRenderer = new ScaleDependentRenderer({
  rendererInfos: [{
    renderer: renderer1,
    maxScale: 10000000,
    minScale: 20000000
  }, {
    renderer: renderer2,
    maxScale: 5000000,
    minScale: 10000000
  }]
});
```

åœ¨4.11çš„APIä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªæ¸²æŸ“ç±»çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿™æ ·æ›¿ä»£è¿™ä¸ªç±»
```js
view.watch("scale", function(newValue) {
    layer.renderer = newValue <= 5000000 ? simpleRenderer : heatmapRenderer;
});
```
åŒç†ï¼Œåœ¨3.xçš„APIåŒæ ·å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•
```js
map.on("zoom-end", function (e) {
  var Scale = map.getScale();
  if (Scale<300000) {
    layer.setRenderer(renderer1);
  } else {
    layer.setRenderer(renderer2);
  }
});
```

## åæœˆ

### CSS3 animationï¼ˆåŠ¨ç”»ï¼‰ å±æ€§

ä½¿ç”¨animationèƒ½å¤Ÿåˆ›å»ºåŠ¨ç”»ï¼Œè¿™å¯ä»¥åœ¨è®¸å¤šç½‘é¡µä¸­å–ä»£åŠ¨ç”»å›¾ç‰‡ã€Flash åŠ¨ç”»ä»¥åŠ JavaScriptã€‚

**å®šä¹‰å’Œç”¨æ³•**

animation å±æ€§æ˜¯ä¸€ä¸ªç®€å†™å±æ€§ï¼Œç”¨äºè®¾ç½®å…­ä¸ªåŠ¨ç”»å±æ€§ï¼š

å€¼|æè¿°
-|-
animation-name |è§„å®šéœ€è¦ç»‘å®šåˆ°é€‰æ‹©å™¨çš„ keyframe åç§°
animation-duration|è§„å®šå®ŒæˆåŠ¨ç”»æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œä»¥ç§’æˆ–æ¯«ç§’è®¡
animation-timing-function|è§„å®šåŠ¨ç”»çš„é€Ÿåº¦æ›²çº¿ï¼ˆï¼‰
animation-delay|è§„å®šåœ¨åŠ¨ç”»å¼€å§‹ä¹‹å‰çš„å»¶è¿Ÿ
animation-iteration-count|è§„å®šåŠ¨ç”»åº”è¯¥æ’­æ”¾çš„æ¬¡æ•°
animation-direction|è§„å®šæ˜¯å¦åº”è¯¥è½®æµåå‘æ’­æ”¾åŠ¨ç”»

**å…·ä½“å€¼ä»‹ç»**

animation-timing-function

* linearï¼šåŠ¨ç”»ä»å¤´åˆ°å°¾çš„é€Ÿåº¦æ˜¯ç›¸åŒçš„ã€‚

* easeï¼šé»˜è®¤ã€‚åŠ¨ç”»ä»¥ä½é€Ÿå¼€å§‹ï¼Œç„¶ååŠ å¿«ï¼Œåœ¨ç»“æŸå‰å˜æ…¢ã€‚

------

animation-iteration-count

* nï¼šå®šä¹‰åŠ¨ç”»æ’­æ”¾æ¬¡æ•°çš„æ•°å€¼ã€‚

* infiniteï¼šè§„å®šåŠ¨ç”»åº”è¯¥æ— é™æ¬¡æ’­æ”¾ã€‚

--------

animation-direction

* normalï¼šé»˜è®¤å€¼ã€‚åŠ¨ç”»åº”è¯¥æ­£å¸¸æ’­æ”¾ã€‚

* alternateï¼šåŠ¨ç”»åº”è¯¥è½®æµåå‘æ’­æ”¾ã€‚

**è¿›åº¦æ¡ç¤ºä¾‹**

ä»Šå¤©çœ‹é¡¹ç›®ä»£ç ï¼Œå‘ç°äº†ä¸€ä¸ªè¿›åº¦æ¡ä½¿ç”¨äº†animationåŠ¨ç”»ï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°±æ”¶çº³ä¸‹æ¥å•¦ğŸ˜

```css
.download-progress {
  width: 150px;
  line-height: 15px;
  height: 15px;
  background: linear-gradient(45deg,
    #007DFF 10%,
    #a4cae7 20%,
    #007DFF 30%,
    #a4cae7 40%,
    #007DFF 50%,
    #a4cae7 60%,
    #007DFF 70%,
    #a4cae7 80%,
    #007DFF 90%,
    #a4cae7 100%);
  border-radius: 15px;
  border: 1px #93d4ff solid;
  background-size: 200% 100%;
  animation: dynamics 3s linear infinite;
  -webkit-animation: dynamics 3s linear infinite;
  -moz-animation: dynamics 3s linear infinite;
  overflow: hidden;
  text-align: right;

@keyframes dynamics {
  0% {
    background-position: 0% 0%;
  }
  100% {
    background-position: 100% 0%;
  }
}
```

**ä»¥åŠä¸€ä¸ªå¥½ç©çš„ç¤ºä¾‹**

```html
<div style="width: 100%;height: 100%;">
  <p id="animated_div">CSS3 åŠ¨ç”»</p>
</div>
```
```css
#animated_div
	{
	  width:60px;
	  height:40px;
	  background:#92B901;
	  position:relative;
	  -webkit-animation: animated_div 5s infinite;
	}

@keyframes animated_div
	{
	  0%		{transform: rotate(0deg);left:0px;}
	  25%		{transform: rotate(20deg);left:0px;}
	  50%		{transform: rotate(0deg);left:500px;}
	  55%		{transform: rotate(0deg);left:500px;}
	  70%		{transform: rotate(0deg);left:500px;background:#1ec7e6;}
	  100%	{transform: rotate(-360deg);left:0px;}
	}
```
æ•ˆæœå¦‚ä¸‹ï¼š
<img :src="('/images/CSS3 animationï¼ˆåŠ¨ç”»ï¼‰å±æ€§/GIF.gif')">

<ToTop/>
